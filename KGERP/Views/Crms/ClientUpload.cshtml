
@model KGERP.Data.CustomModel.CrmUploadListVm
@{
    ViewBag.Title = "Filtered Client List ";
    Layout = "~/Views/Shared/_LayoutCrm.cshtml";
    int sl = 0;
}

<style>
</style>
<section>
    <table>
        <tr>      
            <td>      
                <a href="@Url.Action("ExportClientExcel", "Crms", new
                                                {

                                                    GenderId = Model.GenderId,
                                                    ReligionId = Model.ReligionId,
                                                    ResponsibleOfficerId = Model.ResponsibleOfficerId,
                                                    ProjectId = Model.ProjectId,
                                                    TypeofInterestId = Model.TypeofInterestId,
                                                    StatusId = Model.StatusId,
                                                    SourceofMediaId = Model.SourceofMediaId,
                                                    OfferId = Model.OfferId,
                                                    ChoiceAreaId = Model.ChoiceAreaId,
                                                    lastUploadSerialNo = Model.lastUploadSerialNo,
                                                    companyId= Model.CompanyId
                                                })"
                   class="btn btn-sm btn-secondary">
                    <span class="glyphicon glyphicon-download"></span>  <i class="fa fa-file-excel"></i>  Export
                </a>
            </td>
        </tr>
    </table>
</section>
<section>
    <form action="" method="post">
        <div class="row">
            <div class="col-md-2">
                <div class="form-group">
                    <label class="control-label">Gender</label>
                    <select class="form-control" id="GenderId" name="GenderId" asp-for="GenderId">
                        <option value="">--select Gender--</option>
                        @foreach (var g in Model.GenderList)
                        {
                            if (g.Id == Model.GenderId)
                            {
                                <option value="@g.Id" selected>@g.Name</option>
                            }
                            else
                            {
                                <option value="@g.Id">@g.Name</option>
                            }
                        }
                    </select>
                </div>
            </div>
            <div class="col-md-2">
                <div class="form-group">
                    <label class="control-label">Religion</label>
                    <select class="form-control" id="ReligionId" name="ReligionId" asp-for="ReligionId">
                        <option value="">--select Religion--</option>
                        @foreach (var g in Model.ReligionList)
                        {
                            <option value="@g.Id">@g.Name</option>
                        }
                    </select>
                </div>
            </div>


            @if (Model.IsLeader)
            {
                <div class="col-md-2">
                    <div class="form-group">
                        <label class="control-label">Dealing Officer</label>
                        <select class="form-control" id="ResponsibleOfficerId" name="ResponsibleOfficerId" asp-for="ResponsibleOfficerId">
                            <option value="">--select Dealing Officer--</option>
                            @foreach (var g in Model.DealingOfficerList)
                            {
                                <option value="@g.Id">@g.Name-@g.TeamName</option>
                            }
                        </select>
                    </div>
                </div>
            }
            else if (Model.ManagerId)
            {
                <div class="col-md-2">
                    <div class="form-group">
                        <label class="control-label">Dealing Officer</label>
                        <select class="form-control" id="ResponsibleOfficerId" name="ResponsibleOfficerId" asp-for="ResponsibleOfficerId">
                            <option value="">--select Dealing Officer--</option>
                            @foreach (var g in Model.DealingOfficerList)
                            {
                                <option value="@g.Id">@g.Name-@g.TeamName</option>
                            }
                        </select>
                    </div>
                </div>
            }
            else
            {
                <span>&nbsp;</span>
            }


            <div class="col-md-2">
                <div class="form-group">
                    <label class="control-label">Project</label>
                    <select class="form-control" id="ProjectId" name="ProjectId" asp-for="ProjectId">
                        <option value="">--select Project--</option>
                        @foreach (var g in Model.ProjectList)
                        {
                            <option value="@g.Id">@g.Name</option>
                        }
                    </select>
                </div>
            </div>
            <div class="col-md-2">
                <div class="form-group">
                    <label class="control-label">Type of Interest</label>
                    <select class="form-control" id="TypeofInterestId" name="TypeofInterestId" asp-for="TypeofInterestId">
                        <option value="">--select Interest --</option>
                        @foreach (var g in Model.TypeofInterestList)
                        {
                            <option value="@g.Id">@g.Name</option>
                        }
                    </select>
                </div>
            </div>
            <div class="col-md-2">
                <div class="form-group">
                    <label class="control-label">Service Status</label>
                    <select class="form-control" id="StatusId" name="StatusId" asp-for="StatusId">
                        <option value="">--select Choice of Area--</option>
                        @foreach (var g in Model.ServiceStatusList)
                        {
                            <option value="@g.Id">@g.Name</option>
                        }
                    </select>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-md-2">
                <div class="form-group">
                    <label class="control-label">Source of Media</label>
                    <select class="form-control" id="SourceofMediaId" name="SourceofMediaId" asp-for="SourceofMediaId">
                        <option value="">--select Source of Media--</option>
                        @foreach (var g in Model.SourceofMediaList)
                        {
                            <option value="@g.Id">@g.Name</option>
                        }
                    </select>
                </div>
            </div>
            <div class="col-md-2">
                <div class="form-group">
                    <label class="control-label">Promotional Offer</label>
                    <select class="form-control" id="OfferId" name="OfferId" asp-for="OfferId">
                        <option value="">--select Promotional Offer--</option>
                        @foreach (var g in Model.PromotionalOfferList)
                        {
                            <option value="@g.Id">@g.Name</option>
                        }
                    </select>
                </div>
            </div>
            <div class="col-md-2">
                <div class="form-group">
                    <label class="control-label">Choice of Area</label>
                    <select class="form-control" id="ChoiceAreaId" name="ChoiceAreaId" asp-for="ChoiceAreaId">
                        <option value="">--select Choice of Area--</option>
                        @foreach (var g in Model.ChoiceofAreaList)
                        {
                            <option value="@g.Id">@g.Name</option>
                        }
                    </select>
                </div>
            </div>
           
            
            <div class="col-md-2 row">
                <div class="form-group">
                    <label>&nbsp;</label>
                    <button type="submit" class="form-control bg-primary"><i class="fa fa-search"></i> &nbsp; Filter</button>

                </div>
            </div>

        </div>
   
    </form>
</section>

<table class="table table-sm font-weight-normal table-striped " id="KgErpDataTable" style="margin-top:40px;">
    <thead>
        <tr>
            <th class="p-1">S.L</th>
            <th class="p-1">Date</th>
            <th class="p-1"> Name</th>
            <th class="p-1">Mobile</th>
            <th class="p-1">Dealing Officer</th>
            <th class="p-1">Project</th>
            <th class="p-1">Type of Interest</th>
            <th class="p-1">Status Text</th>
            <th class="p-1">Source of Media</th>
            <th class="p-1">Promotional Offer </th>
            <th class="p-1">Choice Area</th>
            <th class="p-1">Action</th>

        </tr>
    </thead>
    <tbody>
        @foreach (var i in Model.DataList)
        {
            sl = sl + 1;
            <tr>
                <td class="p-1">@{ @sl}</td>
                <td class="p-1">@i.Createdate.ToString("dd-MMM-yyyy")</td>
                <td class="p-1 hvr-underline-from-left">

                    <a href="@Url.Action("GetClientDetailsById", "Crms", new {clientId= i.ClientId, companyId=i.CompanyId})"> @i.Name@*<i class="fa fa-info-circle"></i>*@</a>

                </td>
                <td class="p-1">@i.MobileNo</td>
                <td class="p-1">@i.ResponsibleOfficeName</td>
                <td class="p-1">@i.ProjectText</td>
                <td class="p-1">@i.TypeofInterestText</td>
                <td class="p-1">@i.StatusText</td>
                <td class="p-1">@i.SourceofMediaText</td>

                <td class="p-1">@i.PromotionalOfferText</td>

                <td class="p-1">@i.ChoiceAreaText</td>
                <td class="p-1">
                    <a data-target="#detailModal" class="btn btn-sm btn-primary" onclick="clientDetail(@i.ClientId)"
                       data-toggle="modal" data-placement="top" title="Details">
                        <i class="fa fa-plus"></i> Details
                    </a>
                </td>

            </tr>
        }
    </tbody>

</table>


<div class="modal fade" id="detailModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLongTitle">Client Details</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <table class="table table-striped table-sm">
                    <tr>
                        <td>Name</td>
                        <td>:</td>
                        <td><p id="textclientName"></p></td>
                        <td>Gender</td>
                        <td>:</td>
                        <td><p id="textclientGender"></p></td>
                    </tr>
                    <tr>
                        <td>Mobile</td>
                        <td>:</td>
                        <td><p id="textclientMobile"></p></td>
                        <td>Mobile(2)</td>
                        <td>:</td>
                        <td><p id="textclientMobile2"></p></td>
                    </tr>
                    <tr>
                        <td>Email</td>
                        <td>:</td>
                        <td><p id="textclientEmail"></p></td>
                        <td>Email(2)</td>
                        <td>:</td>
                        <td><p id="textclientEmail2"></p></td>
                    </tr>
                    <tr>
                        <td>Religion</td>
                        <td>:</td>
                        <td><p id="textReligionText"></p></td>
                        <td>Date of Birth</td>
                        <td>:</td>
                        <td><p id="textDateofBirth"></p></td>
                    </tr>
                    <tr>
                        <td>Job Title</td>
                        <td>:</td>
                        <td><p id="textclientJobTitle"></p></td>
                        <td>Organization</td>
                        <td>:</td>
                        <td><p id="textclientOrganization"></p></td>
                    </tr>
                    <tr>
                        <td>Project</td>
                        <td>:</td>
                        <td><p id="textclientProject"></p></td>
                        <td>Status</td>
                        <td>:</td>
                        <td><p id="textclientStatus"></p></td>
                    </tr>
                </table>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
               
            </div>
        </div>
    </div>
</div>
@section scripts {
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-confirm/3.3.2/jquery-confirm.min.js"></script>

    @Scripts.Render("~/bundles/jqueryui")
    @Styles.Render("~/Content/cssjqryUi")
<script>
    function clientDetail(clientId) {
            $.ajax({

                type: "GET",
                url: "@Url.Action("GetClientById", "Crms")",
                datatype: "Json",
                data: { clientId: clientId },
                success: function (data) {
                    
                    $('#textclientName').html(data.Name);
                    $('#textclientGender').html(data.GenderText);
                    $('#textReligionText').html(data.ReligionText);
                    $('#textDateofBirth').html(data.DateofBirth);

                    $('#textclientMobile').html(data.MobileNo);
                    $('#textclientMobileNo2').html(data.MobileNo2);
                    $('#textclientEmail').html(data.Email);
                    $('#textclientEmail2').html(data.Email2);
                    $('#textclientJobTitle').html(data.Email2);
                    $('#textclientOrganization').html(data.Email2);

                    $('#textclientProject').html(data.ProjectText);
                    $('#textclientStatus').html(data.StatusText);

                    $('#clientId').val(data.ClientId);
                    $('#companyId').val(data.CompanyId);
                }
            });
 }
   
</script>

}